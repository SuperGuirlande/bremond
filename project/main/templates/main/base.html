{% load static %}
{% load tailwind_tags %}
<!DOCTYPE html>
<html lang='fr' class="overflow-x-hidden">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-WFSJVNH7MN"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WFSJVNH7MN');
</script>
    <!-- End Google Tag Manager -->

    <!-- Meta Pixel Code -->
    <script>
    !function(f,b,e,v,n,t,s)
    {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
    n.callMethod.apply(n,arguments):n.queue.push(arguments)};
    if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
    n.queue=[];t=b.createElement(e);t.async=!0;
    t.src=v;s=b.getElementsByTagName(e)[0];
    s.parentNode.insertBefore(t,s)}(window, document,'script',
    'https://connect.facebook.net/en_US/fbevents.js');
    fbq('init', '443343545201172');
    fbq('track', 'PageView');
    </script>
    <noscript>
        <img height="1" width="1" style="display:none"
        src="https://www.facebook.com/tr?id=443343545201172&ev=PageView&noscript=1"/>
    </noscript>
    <!-- End Meta Pixel Code -->

    <meta charset='utf-8'>
    <meta name="google-site-verification" content="google2ef000b1d95879d3" />
    <meta name='viewport' content = "width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block title %}Bremond Rénovation - Maçonnerie traditionnelle & Couverture en Charente Maritime{% endblock %}</title>

    <link rel="shortcut icon" href="{% static 'images/logos/logo_final_light.png' %}" type="image/x-icon">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Alex+Brush&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Gilda+Display&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Marcellus&family=Petit+Formal+Script&family=Pinyon+Script&family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Raleway:ital,wght@0,100..900;1,100..900&family=Source+Sans+3:ital,wght@0,200..900;1,200..900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    {% tailwind_css %}
    {% block extra_head %}
    {% endblock %}
</head>

<body class="overflow-x-hidden min-h-screen flex flex-col">
    <!-- Google Tag Manager (noscript) -->
    <noscript>
        <iframe src="https://www.googletagmanager.com/ns.html?id=G-WFSJVNH7MN"
        height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header>
        <!-- NAVBAR -->
        {% include 'main/navbar.html' %}
    </header>
    <main class="flex-1 flex flex-col">
    {% block content %}
    {% endblock %}
    </main>
    <footer class="mt-auto">
        <!-- NAVBAR -->
        {% include 'main/footer.html' %}
    </footer>

    <!-- AOS -->
    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>
    <!-- SMOOTH SCROLL -->
    <script>

        function initSmoothScroll() {
            // Ajouter la classe au HTML pour activer le smooth scroll global
            document.documentElement.classList.add('smooth-scroll');
            
            // Sélectionner tous les boutons de scroll
            const scrollButtons = document.querySelectorAll('.scroll-btn');
            
            scrollButtons.forEach(button => {
                    button.addEventListener('click', (e) => {
                    e.preventDefault();
                    
                    // Récupérer l'ID de la cible depuis l'attribut data-target
                    const targetId = button.getAttribute('data-target');
                    const targetElement = document.querySelector(targetId);
                    
                    if (targetElement) {
                        targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
    }
    
    // Initialiser au chargement
    document.addEventListener('DOMContentLoaded', initSmoothScroll);
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const menuButton = document.getElementById('menuButton');
            const mobileMenu = document.getElementById('mobileMenu');
            let isMenuOpen = false;

            // Toggle du menu mobile
            menuButton.addEventListener('click', function() {
                isMenuOpen = !isMenuOpen;
                
                if (isMenuOpen) {
                    mobileMenu.classList.remove('hidden');
                    mobileMenu.classList.add('animate-fade-in');
                    // Change l'icône en X
                    menuButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    `;
                } else {
                    mobileMenu.classList.add('hidden');
                    mobileMenu.classList.remove('animate-fade-in');
                    // Remet l'icône du hamburger
                    menuButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24">
                            <path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/>
                        </svg>
                    `;
                }
            });

            // Ferme le menu mobile si la fenêtre est redimensionnée au-dessus de lg
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 1024 && isMenuOpen) { // 1024px est le breakpoint lg de Tailwind
                    mobileMenu.classList.add('hidden');
                    isMenuOpen = false;
                    menuButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24">
                            <path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/>
                        </svg>
                    `;
                }
            });
        });
    </script>
    {% block extra_script %}
    {% endblock %}

    <!-- TRACKING EVENTS -->
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // 1. Suivi du temps passé sur la page
        let startTime = new Date();
        window.addEventListener('beforeunload', function() {
            let endTime = new Date();
            let timeSpent = Math.round((endTime - startTime) / 1000);
            gtag('event', 'time_spent', {
                'value': timeSpent,
                'page': window.location.pathname
            });
        });

        // 2. Suivi du défilement de la page
        let maxScroll = 0;
        window.addEventListener('scroll', function() {
            let scrollPercent = Math.round((window.scrollY + window.innerHeight) / document.documentElement.scrollHeight * 100);
            if (scrollPercent > maxScroll) {
                maxScroll = scrollPercent;
                if (maxScroll >= 25 && maxScroll < 50) {
                    gtag('event', 'scroll_depth', { 'depth': '25%' });
                    fbq('trackCustom', 'ScrollDepth', { 'depth': '25%' });
                } else if (maxScroll >= 50 && maxScroll < 75) {
                    gtag('event', 'scroll_depth', { 'depth': '50%' });
                    fbq('trackCustom', 'ScrollDepth', { 'depth': '50%' });
                } else if (maxScroll >= 75 && maxScroll < 90) {
                    gtag('event', 'scroll_depth', { 'depth': '75%' });
                    fbq('trackCustom', 'ScrollDepth', { 'depth': '75%' });
                } else if (maxScroll >= 90) {
                    gtag('event', 'scroll_depth', { 'depth': '90%' });
                    fbq('trackCustom', 'ScrollDepth', { 'depth': '90%' });
                }
            }
        });

        // 3. Suivi des formulaires avec plus de détails
        document.querySelectorAll('form').forEach(form => {
            form.addEventListener('submit', function() {
                let formType = '';
                if (window.location.pathname.includes('contact')) {
                    formType = 'contact';
                } else if (window.location.pathname.includes('recrutement')) {
                    formType = 'recrutement';
                } else {
                    formType = 'autre';
                }

                // Google Analytics
                gtag('event', 'form_submission', {
                    'form_id': form.id || 'unknown',
                    'form_type': formType,
                    'page_path': window.location.pathname,
                    'page_title': document.title
                });
                
                // Facebook Pixel
                fbq('track', 'Lead', {
                    'form_id': form.id || 'unknown',
                    'form_type': formType,
                    'page_path': window.location.pathname
                });
            });
        });

        // 4. Suivi des clics sur les liens de contact
        document.querySelectorAll('a[href^="tel:"], a[href^="mailto:"]').forEach(link => {
            link.addEventListener('click', function() {
                let method = link.href.startsWith('tel:') ? 'phone' : 'email';
                let value = link.href.replace('tel:', '').replace('mailto:', '');
                
                // Google Analytics
                gtag('event', 'contact', {
                    'method': method,
                    'value': value,
                    'page_path': window.location.pathname,
                    'page_title': document.title
                });
                
                // Facebook Pixel
                fbq('track', 'Contact', {
                    'method': method,
                    'value': value
                });
            });
        });

        // 5. Suivi des clics sur les réseaux sociaux
        document.querySelectorAll('a[href*="facebook.com"], a[href*="instagram.com"], a[href*="linkedin.com"]').forEach(link => {
            link.addEventListener('click', function() {
                let network = '';
                if (link.href.includes('facebook.com')) network = 'Facebook';
                else if (link.href.includes('instagram.com')) network = 'Instagram';
                else if (link.href.includes('linkedin.com')) network = 'LinkedIn';

                gtag('event', 'social_click', {
                    'network': network,
                    'page_path': window.location.pathname
                });
                
                fbq('trackCustom', 'SocialClick', {
                    'network': network
                });
            });
        });

        // 6. Suivi des clics sur les images de réalisation
        document.querySelectorAll('.realisation-image, .swiper-slide img').forEach(img => {
            img.addEventListener('click', function() {
                gtag('event', 'image_view', {
                    'image_url': img.src,
                    'page_path': window.location.pathname
                });
                
                fbq('trackCustom', 'ImageView', {
                    'image_url': img.src
                });
            });
        });
    });
    </script>

</body>

</html>